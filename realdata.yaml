# --- Global Pipeline Settings ---
repeats: 1
matching_threshold: 2
use_real_data: true  # True for Real Data, false for Simulation
#if use_real_data, set repeats to ONE!!

# --- Simulation Configuration ---
simulation:
  # General Image Settings
  global_settings:
    n_frames: 500
    img_size: 512
    background_level: 0.3
    read_noise: 8.0

  stationary:
    activate: true
    type: "stationary"
    display_name: "Target Interactions"
    count: 1000
    params:
      fret_efficiency_means: [0.2, 0.8]
      fret_efficiency_stds: [0.04, 0.04]
      total_brightness: [4.0, 12.0]
      
      trans_matrix: [[0.95, 0.05], [0.05, 0.95]]

  aggregate:
    activate: true
    type: "aggregate"
    display_name: "Off-Target Interactions"
    count: 500
    params:
      num_fluor_range: [3, 10]
      fluor_brightness_mean: 1.0
      fluor_brightness_var: 0.1
      fluor_pi: [0.98, 0.02]
      fluor_E_means: [0.2, 0.8]
      fluor_E_stds: [0.15, 0.15]
      fluor_trans_matrix: [[0.95, 0.05], [0.05, 0.95]]
      jitter_std: 0.3

  moving:
    activate: false
    type: "random_walk"
    display_name: "Moving"
    count: 200
    params:
      # INTENSITY MATCHING:
      # Old Sim: [10.0, 20.0]. Matches exactly.
      amplitude: [10.0, 20.0]
      step_size: 5
      min_life: 5
      max_life: 50



# --- Algorithm Configuration ---
algorithms:
  deepfret:
    activate: true
    display_name: "DeepFRET"
    serial_lock_cost: 0
    threads: 4

    params:
      model_path: "algorithms/DEEPFret/main/resources/base/FRET_2C_keras_model.h5"
      spot_threshold: 400
      confidence_threshold: 0.07 #Must have at least this confidence
      alpha: 0.01
      delta: 0.01

  papylio:
    activate: true
    display_name: "Papylio"
    serial_lock_cost: 1
    threads: 1

    params:
      intensity_total_max_threshold: 6000
      intensity_end_min_threshold: 3000
      fraction_difference: 0.2
      neighbourhood_size_min: 15
      neighbourhood_size_max: 5
      projection_max_frame: 1000
      edge_margin: 8
      gaussian_fit_width: 7
      rolling_window_size: 10

  trackpy:
    activate: true
    display_name: "TrackPy"
    serial_lock_cost: 0
    threads: 1

    params:
      channel_index: 1
      frame_limit: 1500
      detection_feature_size: 9  #uneven!
      detection_minmass: 500
      invert_image: false
      processes: 1
      tracking_max_displacement: 4
      tracking_memory: 5
      tracklength_threshold: 20
      displacement_threshold: 2
      merge_dist_detection: 3.0
      merge_dist_selection: 3.0

  stardist:
    activate: true
    display_name: "StarDist"
    serial_lock_cost: 0
    threads: 4

    params:
      channel_index: 0
      norm_percentile_min: 1.0
      norm_percentile_max: 99.8
      axis_norm: [0, 1]
      model_name: '2D_versatile_fluo'
      prob_threshold: 0.1
      nms_threshold: 0.2
      merging_dist: 3.0
      filter:
        tophat_radius: 14
        min_area: 10
        max_area: 40
        max_mean_intensity: 0.8
        min_mean_intensity: 0.12
        max_eccentricity: 0.8
        min_solidity: 0.7
